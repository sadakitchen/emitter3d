var emitter3d=function(t){var e={};function i(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return t[n].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,n){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(n,o,function(e){return t[e]}.bind(null,o));return n},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="/js/",i(i.s=24)}([function(t,e){t.exports=THREE},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);let o;e.circleTexture=function(){if(o)return o;const t=document.createElement("canvas");t.width=256,t.height=256;const e=t.getContext("2d"),i=e.createRadialGradient(128,128,0,128,128,128);return i.addColorStop(0,"rgba(255, 255, 255, 1)"),i.addColorStop(.7,"rgba(255, 255, 255, 1)"),i.addColorStop(.8,"rgba(180, 180, 180, 1)"),i.addColorStop(.9,"rgba(30, 30, 30, 1)"),i.addColorStop(1,"rgba(0, 0, 0, 1)"),e.fillStyle=i,e.fillRect(0,0,256,256),(o=new n.Texture(t)).needsUpdate=!0,o}},function(t,e,i){"use strict";function n(t){return Array.isArray(t)?t:t?[t]:[]}function o(t){return 1!=t.scale&&(l(t,"duration",1),l(t,"defer",0),!0)}function s(t){return l(t,"x",0),l(t,"y",0),l(t,"z",0),!!(t.x||t.y||t.z)&&(l(t,"duration",1),l(t,"defer",0),l(t,"easing","linear"),!0)}function r(t){return l(t,"pitch",0),l(t,"yaw",0),l(t,"roll",0),!!(t.pitch||t.yaw||t.roll)&&(l(t,"duration",1),l(t,"defer",0),l(t,"easing","linear"),!0)}function a(t){return Array.isArray(t.pattern)&&1==t.pattern.length&&(t.pattern=t.pattern[0]),l(t,"duration",1),t.duration?(l(t,"chunk",0),l(t,"chunk",1),l(t,"parallel",0),l(t,"parallel",1)):(delete t.chunk,delete t.parallel),l(t,"defer",0),!0}function l(t,e,i){t[e]==i&&delete t[e]}function c(t,e,i){const o=n(t[e]).filter(i);0==o.length?delete t[e]:1==o.length?t[e]=o[0]:t[e]=o}Object.defineProperty(e,"__esModule",{value:!0}),e.each=n,e.completionTime=function({duration:t,defer:e}){return(t||1)+(e||0)},e.minify=function(t){l(t,"speed",void 0),l(t,"direction","forward"),c(t,"acceleration",o),c(t,"translation",s),c(t,"rotation",r),c(t,"emission",a)}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.diff=function(t,e,i){if(e<=0||i<e)throw"out of range";return t(e/i)-t((e-1)/i)},e.linear=(t=>t),e.easeIn=(t=>t*t),e.easeOut=(t=>t*(2-t)),e.easeInOut=(t=>t<.5?2*t*t:(4-2*t)*t-1)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(3);e.none=(t=>{}),e.vanisher=function(t,e){return i=>{i.frame<=t||(i.opacity*=Math.pow(.005,1/e),i.dead=i.dead||i.frame>t+e)}},e.accelerator=function(t,e=1,i=0){return n=>{n.frame<=i||n.frame>i+e||(n.speed*=Math.pow(t,1/e))}},e.translator=function(t,e=1,i=0,n=o.linear){return s=>{s.frame<=i||s.frame>i+e||s.translate(t,o.diff(n,s.frame-i,e))}},e.rotator=function(t,e=1,i=0,n=o.linear){return s=>{s.frame<=i||s.frame>i+e||s.rotate(t,o.diff(n,s.frame-i,e))}},e.radar=function(t,e=.04,i=.97,o=0){const s=new n.Vector3,r=new n.Quaternion;return n=>{n.frame<=o||(s.set(0,1,0).applyQuaternion(n.rotation),r.setToLookAt(n.position,t,s),n.rotation.rotateTowards(r,e*Math.pow(i,n.frame-o-1)))}},e.compose=function(...t){return e=>{for(const i of t)i(e)}},e.trigger=function(t,e=1,i=0,n=!0){const o=Math.ceil(e/t.length)-1;return s=>{if(s.frame<=i)return;if(s.frame>i+e)return;const r=s.frame-i,a=t.length*(r-1)*(e-o)/(e*e),l=t.length*r*(e-o)/(e*e);for(let e=Math.ceil(a);e<l;++e)t[e](s);s.dead=s.dead||n&&Math.ceil(l)==t.length}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);class o{constructor(t,e,i){this.field=t,this.feature=e,this.metadata=i,this.position=new n.Vector3,this.rotation=new n.Quaternion,this.frame=0,this.speed=0,this.opacity=1,this.dead=!1,t.onCreate(this)}translate({x:t,y:e,z:i},n=1){return o.temporaryVector.set(t?t*n:0,e?e*n:0,i?i*n:0).applyQuaternion(this.rotation),this.position.add(o.temporaryVector),this}rotate({pitch:t,yaw:e,roll:i,order:n},s=1){return o.temporaryQuaternion.setFromEulerAngles(t?t*s:0,e?e*s:0,i?i*s:0,n),this.rotation.multiply(o.temporaryQuaternion),this}update(){++this.frame,this.feature(this),this.translate({z:this.speed})}}o.temporaryVector=new n.Vector3,o.temporaryQuaternion=new n.Quaternion,e.Particle=o;e.Field=class{constructor(){this.living=new Set,this.created=new Set,this.died=new Set}onCreate(t){this.created.add(t)}[Symbol.iterator](){return this.living[Symbol.iterator]()}update(){for(const t of this.created)this.living.add(t);this.created.clear();for(const t of this.living)t.update(),t.dead&&this.died.add(t);for(const t of this.died)this.living.delete(t);this.died.clear()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);e.antialiasModes=["OFF","SMAA","MSAA x2","MSAA x4"];e.Renderer=class{constructor(t,e){this.webGL=new n.WebGLRenderer({antialias:!1}),this.webGL.setPixelRatio(window.devicePixelRatio),this.passes={render:new n.RenderPass(t,e),renderMSAA:new n.ManualMSAARenderPass(t,e),focus:new n.ShaderPass(n.FocusShader),bloom:new n.UnrealBloomPass,copy:new n.ShaderPass(n.CopyShader),SMAA:new n.SMAAPass(2,2)},this.passes.copy.renderToScreen=!0,this.passes.SMAA.renderToScreen=!0,this.composer=new n.EffectComposer(this.webGL),this.composer.addPass(this.passes.render),this.composer.addPass(this.passes.renderMSAA),this.composer.addPass(this.passes.focus),this.composer.addPass(this.passes.bloom),this.composer.addPass(this.passes.copy),this.composer.addPass(this.passes.SMAA),this.antialiasMode="OFF",this.bloom=!1}get domElement(){return this.webGL.domElement}set antialiasMode(t){this.passes.renderMSAA.enabled="MSAA"==t.slice(0,4),this.passes.renderMSAA.sampleLevel="MSAA x2"==t?1:"MSAA x4"==t?2:0,this.passes.SMAA.enabled="SMAA"==t,this.passes.render.enabled=!this.passes.renderMSAA.enabled,this.passes.copy.enabled=!this.passes.SMAA.enabled}set focus(t){this.passes.focus.enabled=t}set bloom(t){this.passes.bloom.enabled=t}set bloomStrength(t){this.passes.bloom.strength=t}set bloomRadius(t){this.passes.bloom.radius=t}set bloomThreshold(t){this.passes.bloom.threshold=t}setSize(t,e){this.webGL.setSize(t,e);const i=this.webGL.getPixelRatio();this.composer.setSize(Math.floor(t*i),Math.floor(e*i))}render(){this.composer.render()}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(2);function s(t=0,e=1,i=1,n=1){let o=0;for(let t=0;t<i;++t)o+=Math.pow(Math.random(),n);return t+(e-t)*(o/=i)}function r(t,e,i=1,n=1){return Math.floor(s(t,e,i,n))}e.Generator=class{hasConflict(t,e){if(!(t&&e&&t.duration&&e.duration))return!1;const i=t.defer||0,n=e.defer||0,o=i+(t.duration||1),s=n+(e.duration||1);return i<=n&&n<o||n<=i&&i<s}pattern(t,e={generation:[]}){const i=2<=t,n=this.speed(i,e),s=this.direction(i,e),[r,a]=this.acceleration(n,i,e),l=this.rotation(r,e),c=this.emission(t,e);if(this.hasConflict(c,r)||this.hasConflict(c,l))return this.pattern(t,e);const h={speed:a,direction:s,acceleration:r,rotation:l,emission:c};o.minify(h);const u=this.metadata(h,e);return Object.assign(h,u)}speed(t,e){return 0==e.generation.length?0:s(1,1.4)*(1-.1*e.generation[0])}direction(t,e){return!t||0==e.generation.length||e.omni?"forward":s()<.3?"backward":"forward"}acceleration(t,e,i){if(0==i.generation.length)return[{scale:1},t];const n=s(),o=1+.2*i.generation[0];if(n<.05){const e=20;return[{scale:e,defer:r(40,120)},1.4*t/e]}if(n<.2){const i=r(0,20)+(e?20:0),n=s(4,5,3)-(e?1.5:0);return[{scale:n,defer:i,duration:r(20,40,3)},1.2*t/n]}if(n<.3*o&&e)return[{scale:.01,defer:r(5,20)},2*t];if(n<.4*o){const i=r(0,20),n=s(.2+.01*i,.6,3);return[{scale:n,defer:i,duration:r(20,40,3)},t*(e?.7:.8)/n]}return[{scale:1},t]}rotation(t,e){if(0==e.generation.length)return{};if(s()<.5)return{};const i=s()<.3?0:s(0,2*Math.PI,1,6),n=s()<.3?0:s(0,2*Math.PI,1,4),o=s()<.3?0:s(0,2*Math.PI,1,4);return{pitch:i,yaw:n,roll:o,duration:Math.abs(i)>Math.PI/2||Math.abs(n)>Math.PI/2||Math.abs(o)>Math.PI?r(60,120):r(30,60),easing:"ease-out"}}reverse(t){const e=Object.assign({},t);return e.pitch&&(e.pitch=-e.pitch),e.yaw&&(e.yaw=-e.yaw),e.roll&&(e.roll=-e.roll),e}emission(t,e){if(t<2)return;const i=0==e.generation.length,o=i?0:e.generation[0],a=e.generation.reduce((t,e)=>t+1+e,0),l=n.Math.clamp(t/Math.max(1,3-a),2,64);let c=r(Math.min(2+a,l),l,1,1/(1+3*a));const h=this.emissionFormations(e),u=h[r(0,h.length)],d=1+r(0,3,1,.7+2*a);let p=s()<.35-.1*o?10*r(1,6):void 0,f=p&&s()<.15?d:1,g=p&&s()<.5?r(1,5):1;const m=i?0:10*r(3,7)+40*o,y=this.emissionRange(u);if("id"==u){if(i||e.overlap||!p)return this.emission(t,e);3<c&&(c=2+c%2),f=1,g=1,p=10*r(2,9,3)}else if(1!=d&&c/d/g<4)return this.emission(t,e);if(c%d!=0||p&&p<c/(f*g)*("id"==u?5:1)*(1==d?3:1)||1!=g&&(c<2*g||g%d!=0||c%g!=0)||y&&(i||c/y>6))return this.emission(t,e);const b=void 0==y&&"id"!=u,w="id"==u,M=new Array(d);for(let i=0;i<M.length;++i)M[i]=this.pattern(t/c,{generation:[i,...e.generation],omni:b,overlap:w});return 1==M.length&&M[0].rotation&&c%2==0&&s()<.5&&M.push(Object.assign({},M[0],{rotation:this.reverse(M[0].rotation)})),{num:c,chunk:f,parallel:g,formation:u,range:y,pattern:M,duration:p,defer:m}}emissionFormations(t){if(0==t.generation.length)return["horizontal"];switch(t.generation[0]){case 0:return["id","horizontal","vertical","split"];case 1:return["id","horizontal","vertical"];case 2:default:return["horizontal","vertical"]}}emissionRange(t){if(!("horizontal"==t&&s()<.5||"split"==t&&s()<.5))switch(t){case"horizontal":return Math.PI*s(.2,.8);case"vertical":return Math.PI*s(.1,.9);case"split":case"splash":return Math.PI*s(.2,.4);default:return}}}},function(t,e,i){"use strict";function n(t,e){const i=new Array(t);for(let n=0;n<t;++n)i[n]=e(n);return i}function o(t,e,i){return 1==t?[i(0)]:(e%Math.PI*2==0&&(e=e/t*(t-1)),n(t,n=>i(-e/2+e/(t-1)*n)))}Object.defineProperty(e,"__esModule",{value:!0}),e.id=function(t){return{units:n(t,t=>({}))}},e.horizontal=function(t,e){return{units:o(t,e,t=>({yaw:t}))}},e.vertical=function(t,e){return{units:o(t,e,t=>({pitch:t}))}},e.split=function(t,e){return{units:o(t,2*Math.PI,t=>({pitch:e,roll:t})),order:"ZXY"}},e.splash=function(t,e){return{units:n(t,t=>({pitch:Math.random()*e,roll:Math.random()*Math.PI*2})),order:"ZXY"}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(3),o=i(8),s=i(5),r=i(4),a=i(2);function l(t,e,i=0){const n=[];for(let i=0;i<t.length;i+=e)n.push(t.slice(i,i+e));const o=t.length%e;if(2<=n.length&&0<o&&o<=e*i){const t=n.pop();n[n.length-1].push(...t)}return n}e.Composer=class{pattern(t){const e=t.speed,i=this.direction(t.direction),n=r.compose(...this.patternFeatures(t));return o=>{const r=new s.Particle(o.field,n,t);return r.position.copy(o.position),r.rotation.copy(o.rotation),r.speed=void 0===e?o.speed:e,r.rotate(i),r}}patternFeatures(t){const e=[];for(const i of a.each(t.acceleration))e.push(this.acceleration(i));for(const i of a.each(t.translation))e.push(this.translation(i));for(const i of a.each(t.rotation))e.push(this.rotation(i));const i=Math.max(...a.each(t.emission).map(a.completionTime));for(const n of a.each(t.emission))e.push(this.emission(n,a.completionTime(n)==i));return e}direction(t){switch(t){case"backward":return{pitch:Math.PI};case"forward":default:return{}}}acceleration({scale:t,duration:e,defer:i}){return r.accelerator(t,e,i)}translation({x:t,y:e,z:i,duration:n,defer:o,easing:s}){return r.translator({x:t,y:e,z:i},n,o,this.easing(s))}rotation({pitch:t,yaw:e,roll:i,order:n,duration:o,defer:s,easing:a}){return r.rotator({pitch:t,yaw:e,roll:i,order:n},o,s,this.easing(a))}emission({num:t,formation:e,chunk:i,parallel:n,range:o,pattern:s,duration:a,defer:c},h=!0){if(Array.isArray(s)||(s=[s]),0==t||0==s.length)return r.none;const u=s.map(t=>this.pattern(t));let d=this.formation(t,e,o).map((t,e)=>{const i=u[e%u.length];return e=>{i(e).rotate(t)}});return i&&1<i&&(d=l(d,i,.4).map(t=>r.compose(...t))),n&&1<n&&(d=function(t,e){const i=Math.ceil(t.length/e),n=l(t,i),o=t.length%i;return n[0].map((t,e)=>{const i=n.map(t=>t[e]);return o&&o<=e&&i.pop(),i})}(d,n).map(t=>r.compose(...t))),r.trigger(d,a,c,h)}formation(t,e,i){const{units:n,order:s}=function(){switch(e){case"horizontal":return o.horizontal(t,void 0===i?2*Math.PI:i);case"vertical":return o.vertical(t,void 0===i?.3*Math.PI:i);case"split":return o.split(t,void 0===i?.49*Math.PI:i);case"splash":return o.splash(t,void 0===i?.25*Math.PI:i);case"id":default:return o.id(t)}}();return s?n.map(t=>Object.assign({order:s},t)):n}easing(t){switch(t){case"ease-in":return n.easeIn;case"ease-out":return n.easeOut;case"ease-in-out":return n.easeInOut;case"linear":return n.linear;default:return}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(5);e.Particle=n.Particle,e.Field=n.Field;const o=i(4);e.feature=o;var s=i(9);e.Composer=s.Composer;var r=i(7);e.Generator=r.Generator},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);function o(t,e,i){return new n.Vector3(t,e,i)}function s(...t){const e=new n.Vector3;for(const i of t)e.add(i);return e.divideScalar(t.length)}e.at=o,e.color=function(t,e,i){return new n.Color(t,e,i)},e.center=s;class r extends n.Object3D{constructor(){super(...arguments),this.points=[],this.indices=[],this.cache=new Map}putPoint(t,e){const i=[t.x,t.y,t.z,e.r,e.g,e.b].sort().reduce((t,e)=>t+e,0),n=this.cache.get(i),o=n&&n.find(i=>i.position.equals(t)&&i.color.equals(e));if(o)return o;const s=this.points.length,r={id:this.id,index:s,position:t,color:e};return this.points.push(r),n?n.push(r):this.cache.set(i,[r]),r}fillTriangleFan(...t){return console.assert(!t.find(t=>t.id!=this.id)),a(t,(t,e,i)=>this.indices.push(t.index,e.index,i.index)),this}fillTriangleStrip(...t){return console.assert(!t.find(t=>t.id!=this.id)),l(t,(t,e,i)=>this.indices.push(t.index,e.index,i.index)),this}fillBlur(t,e,i,n){if(t.length<2)return this;let o=t[0],s=this.putPoint(c(o.position,n,e),i);for(let r=1;r<t.length;++r){const a=t[r],l=this.putPoint(c(a.position,n,e),i);this.fillTriangleStrip(o,s,a,l),o=a,s=l}return this}fillInner(t,e,i,n){return this.fillBlur(t,-e,i,n)}fillOuter(t,e,i,n){return this.fillBlur(t,e,i,n)}fillTriangleInner(t,e,i,n,o){return this.fillInner([t,e,i,t],n,o,s(t.position,e.position,i.position))}fillTriangleFanInner(t,e,i){return a(t,(t,n,o)=>this.fillTriangleInner(t,n,o,e,i)),this}fillTriangleStripInner(t,e,i){return l(t,(t,n,o)=>this.fillTriangleInner(t,n,o,e,i)),this}fillLine(t,e,i,n){const s=t.position.clone().sub(e.position).normalize(),r=this.putPoint(t.position.clone().addScaledVector(s,i),n),a=this.putPoint(e.position.clone().addScaledVector(s,-i),n),l=0==s.x&&0==s.y?o(0,1,0):o(0,0,1);l.cross(s).normalize().multiplyScalar(i);for(let i=0;i<4;++i){const i=this.putPoint(t.position.clone().add(l),n),o=this.putPoint(e.position.clone().add(l),n);this.fillTriangleStrip(r,i,t,o,e,a),l.applyAxisAngle(s,Math.PI/2)}return this}copy(t){return super.copy(t),this.points=[...t.points],this.indices=[...t.indices],this.cache=new Map(t.cache),this}build(){this.updateMatrixWorld(!0);const t=[],e=[],i=[],o=new n.Vector3;let s=0;return this.traverseVisible(n=>{if(!(n instanceof r))return;const a=n.points.length;t.length+=3*a,e.length+=3*a,n.points.forEach((i,r)=>{o.copy(i.position).applyMatrix4(n.matrixWorld),t[3*(s+r)]=o.x,t[3*(s+r)+1]=o.y,t[3*(s+r)+2]=o.z,e[3*(s+r)]=i.color.r,e[3*(s+r)+1]=i.color.g,e[3*(s+r)+2]=i.color.b}),i.push(...n.indices.map(t=>t+s)),s+=a}),{position:new n.BufferAttribute(new Float32Array(t),3),color:new n.BufferAttribute(new Float32Array(e),3),index:new n.BufferAttribute(new Uint16Array(i),1)}}}function a(t,e){console.assert(t.length>2);const i=t[0];let n=t[1];for(let o=2;o<t.length;++o){const s=t[o];e(i,n,s),n=s}}function l(t,e){console.assert(t.length>2);let i=t[0],n=t[1];for(let o=2;o<t.length;++o){const s=t[o];o%2==0?e(i,n,s):e(i,s,n),i=n,n=s}}function c(t,e,i){return t.clone().sub(e).normalize().multiplyScalar(i).add(t)}e.GeometryBuilder=r},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(11);e.Objects=class extends n.Group{constructor(t){super(),this.missiles=new s(t,function(){const t=new o.GeometryBuilder;for(let e=0;e<8;++e){const i=2*Math.PI/8*e,s=2*Math.PI/8*(e+1),r=e%2==0?1:.2,a=e%2==0?-.2:-1,l=o.at(Math.cos((i+s)/2),Math.sin((i+s)/2),(r+a)/2),h=o.at(0,0,(r+a)/2),u=(new n.Color).setHSL(e/8,.3,.3),d=(new n.Color).setHSL(e/8,.3,.8),p=[t.putPoint(o.at(Math.cos(i),Math.sin(i),r),u),t.putPoint(o.at(Math.cos(s),Math.sin(s),r),u),t.putPoint(o.at(Math.cos(i),Math.sin(i),a),u),t.putPoint(o.at(Math.cos(s),Math.sin(s),a),c)],f=[t.putPoint(o.at(Math.cos(i),Math.sin(i),r),d),t.putPoint(o.at(Math.cos(s),Math.sin(s),r),d),t.putPoint(o.at(Math.cos(i),Math.sin(i),a),c),t.putPoint(o.at(Math.cos(s),Math.sin(s),a),c)];t.fillTriangleFan(p[2],p[0],p[1],p[3]),t.fillInner([f[2],f[0],f[1],f[3]],.2,c,l),t.fillOuter([f[2],f[0],f[1],f[3]],.2,c,h)}return t.scale.set(2,2,6),t}().build()),this.arrows=new s(t,function(){const t=new o.GeometryBuilder,e={head:t.putPoint(o.at(0,0,1),o.color(.4,.4,.4)),body:[o.color(.7,.1,.1),o.color(.1,.7,.1),o.color(.1,.1,.7)].map((e,i)=>{const n=2*Math.PI/3*i;return t.putPoint(o.at(Math.cos(n),Math.sin(n),-1),e)})},i={head:t.putPoint(e.head.position,l),body:e.body.map(e=>t.putPoint(e.position,e.color.clone().addScalar(.3))),heart:t.putPoint(o.at(0,0,0),l),tail:t.putPoint(o.at(0,0,-5),c)};return t.fillTriangleFan(e.head,...e.body,e.body[0]),t.fillTriangleFanInner([i.head,...i.body,i.body[0]],.2,c),t.fillTriangleFanInner(i.body,.2,c),i.body.forEach((e,n)=>{const o=i.body[(n+1)%3];t.fillOuter([i.head,e,o],.2,c,i.heart.position)}),t.fillLine(i.heart,i.tail,.2,c),t.scale.set(2.5,2.5,4),t}().build()),this.claws=new s(t,function(){const t=new o.GeometryBuilder,e={head:t.putPoint(o.at(.1,0,.7),o.color(.5,.5,.5)),body:[o.at(.1,.2,0),o.at(.5,0,0),o.at(.1,-.2,0)].map(e=>t.putPoint(e,o.color(.2,.2,.2))),tail:t.putPoint(o.at(.1,0,-.3),o.color(.2,.2,.2))},i={head:t.putPoint(e.head.position,l),body:e.body.map(e=>t.putPoint(e.position,o.color(.5,.5,.5))),tail:t.putPoint(e.tail.position,o.color(.5,.5,.5))};t.fillTriangleFan(e.body[1],e.head,e.body[2],e.tail,e.body[0],e.head);for(let e=0;e<3;++e){if(2!=e){const n=o.center(i.body[e].position,i.body[e+1].position);t.fillInner([i.head,i.body[e],i.tail,i.body[e+1],i.head],.1,c,n)}const n=o.center(i.head.position,i.tail.position);t.fillOuter([i.head,i.body[e],i.tail],.1,c,n)}const n=t.clone();n.rotateZ(Math.PI);const s=new o.GeometryBuilder;return s.add(t),s.add(n),s.scale.set(4.5,4.5,8),s}().build()),this.add(this.missiles),this.add(this.arrows),this.add(this.claws)}beginUpdate(){const t=this.missiles.beginUpdate(),e=this.arrows.beginUpdate(),i=this.claws.beginUpdate(),o=new n.Quaternion,s=new n.Quaternion;return{put(n,r,a,l,c){switch(n){case"missile":o.copy(l).multiply(s.setFromEulerAngles(0,0,.02*Math.PI*r)),t.put(a,o,c);break;case"arrow":o.copy(l).multiply(s.setFromEulerAngles(0,0,.01*Math.PI*r)),e.put(a,o,c);break;case"claw":o.copy(l).multiply(s.setFromEulerAngles(0,0,-.01*Math.PI*r)),i.put(a,o,c)}},complete(){t.complete(),e.complete(),i.complete()}}}};class s extends n.Mesh{constructor(t,e){super(s.geometry(t,e),s.material()),this.capacity=t}beginUpdate(){const t=this.geometry,e=t.getAttribute("position"),i=t.getAttribute("rotation"),n=t.getAttribute("color");let o=0;return{put:(t,s,r)=>{o>=this.capacity||(e.setXYZ(o,t.x,t.y,t.z),i.setXYZW(o,s.x,s.y,s.z,s.w),n.setXYZ(o,r.r,r.g,r.b),++o)},complete:()=>{t.maxInstancedCount=o,e.needsUpdate=!0,i.needsUpdate=!0,n.needsUpdate=!0}}}static geometry(t,e){function i(e){const i=new n.InstancedBufferAttribute(new Float32Array(t*e),e,1);return i.setDynamic(!0),i}const o=new n.InstancedBufferGeometry;return o.maxInstancedCount=0,o.addAttribute("objectPosition",e.position),o.addAttribute("objectColor",e.color),o.addAttribute("position",i(3)),o.addAttribute("rotation",i(4)),o.addAttribute("color",i(3)),o.setIndex(e.index),o}static material(){return new n.RawShaderMaterial({uniforms:{},vertexShader:r,fragmentShader:a,side:n.DoubleSide,transparent:!0,blending:n.AdditiveBlending,depthTest:!1})}}const r="\n  precision highp float;\n\n  uniform mat4 modelViewMatrix;\n  uniform mat4 projectionMatrix;\n\n  attribute vec3 objectPosition;\n  attribute vec3 objectColor;\n  attribute vec3 position;\n  attribute vec4 rotation;\n  attribute vec3 color;\n\n  varying vec4 vColor;\n\n  void main() {\n    vec3 vPosition = objectPosition + cross(rotation.xyz, cross(rotation.xyz, objectPosition) + rotation.w * objectPosition) * 2.0;\n\n    vColor = vec4(objectColor * color, 1.0);\n\n    gl_Position = projectionMatrix * modelViewMatrix * vec4(position + vPosition, 1.0);\n  }\n",a="\n  precision highp float;\n\n  varying vec4 vColor;\n\n  void main() {\n    gl_FragColor = vColor;\n  }\n",l=o.color(1,1,1),c=o.color(0,0,0)},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(1);class s extends n.Points{constructor(t){super(new n.BufferGeometry,s.material()),this.capacity=t,this.buffer=this.geometry,this.buffer.setDrawRange(0,0),this.positions=new n.BufferAttribute(new Float32Array(3*t),3),this.colors=new n.BufferAttribute(new Float32Array(3*t),3),this.positions.setDynamic(!0),this.colors.setDynamic(!0),this.buffer.addAttribute("position",this.positions),this.buffer.addAttribute("color",this.colors),this.frustumCulled=!1}beginUpdate(){let t=0;return{put:(e,i)=>{t>=this.capacity||(this.positions.setXYZ(t,e.x,e.y,e.z),this.colors.setXYZ(t,i.r,i.g,i.b),++t)},complete:()=>{this.buffer.setDrawRange(0,t),this.positions.needsUpdate=!0,this.colors.needsUpdate=!0}}}static material(){return new n.PointsMaterial({color:16777215,map:o.circleTexture(),vertexColors:n.VertexColors,size:5,transparent:!0,blending:n.AdditiveBlending,depthWrite:!1})}}e.Points=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(1);class s extends n.Points{constructor(t,e){super(s.randomPointsGeometry(t,1.5*t,e),s.material()),this.boundary=t}static randomPointsGeometry(t,e,i){const o=new n.Vector3(0,0,0);function s(){const i=o.clone();do{i.set(e-Math.random()*e*2,e-Math.random()*e*2,e-Math.random()*e*2)}while(i.distanceTo(o)<t||e<i.distanceTo(o));return i}const r=new n.Geometry;for(let t=0;t<i;++t){const t=s(),e=new n.Color(0,0,0);e.setHSL(5e-4*(t.x+t.y+t.z)%1,1,.8),r.vertices.push(t),r.colors.push(e)}return r}static material(){return new n.PointsMaterial({color:16777215,map:o.circleTexture(),vertexColors:n.VertexColors,size:6,transparent:!0,blending:n.AdditiveBlending,depthWrite:!1})}}e.Space=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(1);class s extends n.Points{constructor(t,e,i){super(new n.PlaneBufferGeometry(t*e*2,t*i*2,2*e,2*i),s.material),this.frustumCulled=!1}}s.material=new n.PointsMaterial({color:1118481,map:o.circleTexture(),size:2,transparent:!0,blending:n.AdditiveBlending,depthWrite:!1}),e.Surface=s},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});e.History=class{constructor(t,e){this.alloc=t,this.head=0,this.payload=new Array(e);for(let t=0;t<this.payload.length;++t)this.payload[t]={array:[],length:0}}get capacity(){return this.payload.length}putSnapshot(t,e){this.head=(this.head+1)%this.payload.length;const i=this.payload[this.head];let n=0;for(const o of t)i.array.length<=n&&i.array.push(this.alloc()),e(o,i.array[n]),++n;i.length=n}clear(t=!1){for(let e=0;e<this.payload.length;++e)this.payload[e].length=0,t&&(this.payload[e].array=[])}*snapshots(t=0,e=this.payload.length,i=1){console.assert(e<=this.payload.length);for(let n=t;n<t+e;n+=i)yield this.snapshot(n)}*snapshot(t){console.assert(t<this.payload.length);const e=this.payload[(this.head-t+this.payload.length)%this.payload.length];for(let t=0;t<e.length;++t)yield e.array[t]}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=i(16),s=i(6),r=i(15),a=i(14),l=i(13),c=i(12);function h(){return{frame:0,position:new n.Vector3,rotation:new n.Quaternion,fluctuation:new n.Vector3,objectModel:"meta",colorIndex:0,opacity:0}}e.particleTypes=["points","objects"];e.View=class{constructor(t){this.container=t,this.needsUpdate=!1,this.trailLength=1,this.trailStep=1,this.trailOpacity=1,this.trailAttenuation=1,this.trailFluctuation=1,this.hue=.9,this.lightness=.7,this.history=new o.History(h,60),this.scene=new n.Scene,this.scene.fog=new n.FogExp2(0,.001),this.camera=new n.PerspectiveCamera(70,1,1,2e3),this.renderer=new s.Renderer(this.scene,this.camera),this.container.appendChild(this.renderer.domElement),window.addEventListener("resize",this.updateSize.bind(this)),this.updateSize(),this.surface=new r.Surface(20,40,40),this.surface.rotation.set(Math.PI/2,0,0),this.scene.add(this.surface),this.space=new a.Space(400,5e3),this.scene.add(this.space),this.points=new l.Points(4e4),this.points.visible=!1,this.scene.add(this.points),this.objects=new c.Objects(1e4),this.objects.visible=!1,this.scene.add(this.objects)}get width(){return this.container.clientWidth}get height(){return this.container.clientHeight}set particleType(t){this.points.visible="points"==t,this.objects.visible="objects"==t}updateSize(){this.camera.aspect=this.width/this.height,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.width,this.height)}render(){this.needsUpdate&&(this.needsUpdate=!1,this.points.visible&&this.updatePoints(),this.objects.visible&&this.updateObjects()),this.renderer.render()}updatePoints(){const t=this.points.beginUpdate();this.iterateParticles((e,i,n)=>t.put(i,n)),t.complete()}updateObjects(){const t=this.objects.beginUpdate();this.iterateParticles((e,i,n)=>t.put(e.objectModel,e.frame,i,e.rotation,n)),t.complete()}iterateParticles(t){const e=[[5,.98],[20,.91],[70,.87],[110,.91],[150,.87],[230,1],[255,1],[335,.95]],i=new n.Vector3,o=new n.Color;let s=1,r=1;for(const n of this.history.snapshots(0,this.trailLength,Math.floor(this.trailStep))){for(const a of n){if("meta"==a.objectModel)continue;const[n,l]=e[a.colorIndex%e.length];i.copy(a.position).addScaledVector(a.fluctuation,1-r),o.setHSL((1+n/360+.001*i.y)%1,this.hue,this.lightness*l*Math.min(1,.1+.03*a.frame)*a.opacity*s),t(a,i,o)}1==s&&(s*=this.trailOpacity),s*=this.trailAttenuation,r*=this.trailFluctuation}}}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=i(6);e.Renderer=n.Renderer,e.antialiasModes=n.antialiasModes;var o=i(17);e.particleTypes=o.particleTypes,e.View=o.View},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0);function o(t){return Array.prototype.slice.call(t)}function s(t,e){return Math.sqrt(Math.pow(t.clientX-e.clientX,2)+Math.pow(t.clientY-e.clientY,2))}e.Satellite=class{constructor(t,e){this._lastDragPos=new n.Vector2(0,0),this._isDragging=!1,this.autoRevolve=!1,this.touchList=[],this._target={py:new n.Vector2(30,0),distance:e},this._current={py:new n.Vector2(30,0),distance:e},t.addEventListener("mousedown",t=>this.onMouseDown(t),!1),t.addEventListener("mousemove",t=>this.onMouseMove(t),!1),t.addEventListener("mouseup",t=>this.onMouseUp(t),!1),t.addEventListener("mouseout",t=>this.onMouseOut(t),!1),t.addEventListener("wheel",t=>this.onWheel(t),!1),t.addEventListener("touchstart",t=>this.onTouchStart(t),!1),t.addEventListener("touchmove",t=>this.onTouchMove(t),!1),document.addEventListener("touchend",t=>this.onTouchEnd(t),!1)}get isDragging(){return this._isDragging}handleDragStart(t,e){this._lastDragPos.set(t,e),this._isDragging=!0}handleDragMove(t,e){if(!this._isDragging)return;const i=new n.Vector2(.35*(e-this._lastDragPos.y),.35*(t-this._lastDragPos.x));this._target.py.add(i),this._lastDragPos.set(t,e)}handleDragEnd(){this._isDragging=!1}handleZoom(t){this._target.distance+=t,this._target.distance<10&&(this._target.distance=10)}onMouseDown(t){0==t.button&&(t.preventDefault(),this.handleDragStart(t.clientX,t.clientY))}onMouseMove(t){this.handleDragMove(t.clientX,t.clientY)}onMouseUp(t){0==t.button&&this.handleDragEnd()}onMouseOut(t){this.handleDragEnd()}onWheel(t){this.handleZoom(20*(t.deltaY<0?-1:1))}onTouchStart(t){t.preventDefault();for(const e of o(t.changedTouches))this.touchList.push(e);if(1==this.touchList.length){const t=this.touchList[0];this.handleDragStart(t.clientX,t.clientY)}}onTouchMove(t){const e={};for(const i of o(t.changedTouches))e[i.identifier]=i;if(1==this.touchList.length){const t=e[this.touchList[0].identifier];t&&this.handleDragMove(t.clientX,t.clientY)}else{const t=s(this.touchList[0],this.touchList[1]);for(let t of[0,1]){const i=e[this.touchList[t].identifier];i&&(this.touchList[t]=i)}const i=s(this.touchList[0],this.touchList[1]);this.handleZoom(t-i)}}onTouchEnd(t){for(const e of o(t.changedTouches))for(let t=0;t<this.touchList.length;++t)if(this.touchList[t].identifier==e.identifier){this.touchList.splice(t,1),this.handleDragEnd();break}}update(t){!this._isDragging&&this.autoRevolve&&(this._target.py.y+=.1),this._target.py.x=n.Math.clamp(this._target.py.x,-90,90),this._current.py.multiplyScalar(.75),this._current.py.addScaledVector(this._target.py,.25),this._current.distance*=.75,this._current.distance+=.25*this._target.distance;const e=n.Math.clamp(this._current.py.x,-90,90),i=n.Math.degToRad(90-e),o=n.Math.degToRad(this._current.py.y);t.position.set(this._current.distance*Math.sin(i)*Math.cos(o),this._current.distance*Math.cos(i),this._current.distance*Math.sin(i)*Math.sin(o)),t.lookAt(new n.Vector3(0,0,0))}}},function(t,e){t.exports=dat},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(20);class o{constructor(t=new n.GUI,e={}){this.gui=t,this.params=e,this.gui.close()}open(){return this.gui.open(),this}close(){return this.gui.close(),this}folder(t){return new o(this.gui.addFolder(t))}toggle(t,e){return this.add(t,e,[])}options(t,e,i){return this.add(t,e,[i])}range(t,e,[i,n]){return this.add(t,e,[i,n])}add(t,e,i){this.params[t]=e;const n=this.gui.add(this.params,t,...i);return new s(n)}}e.Config=o;class s{constructor(t){this.controller=t,this.handlers=new Set,this.controller.onChange(this.onChange.bind(this))}onChange(t){for(const e of this.handlers)e(t)}get value(){return this.controller.getValue()}set value(t){this.controller.setValue(t)}handle(t){return this.handlers.add(t),t(this.value),this}bind(t,e){return this.handle(i=>t[e]=i),this}step(t){return this.controller.step(t),this}}e.Input=s},function(t,e){t.exports=Stats},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});const n=i(0),o=new n.Matrix4,s=new n.Euler;n.Quaternion.prototype.setToLookAt=function(t,e,i){return o.lookAt(e,t,i),this.setFromRotationMatrix(o),this},n.Quaternion.prototype.setFromEulerAngles=function(t,e,i,n){return s.set(t,e,i,n),this.setFromEuler(s),this},n.Quaternion.prototype.distanceTo=function(t){return 2*Math.acos(Math.abs(this.dot(t)))},n.Quaternion.prototype.rotateTowards=function(t,e){if(0==e)return this;const i=this.distanceTo(t);return i<e?this.copy(t):this.slerp(t,e/i)}},function(t,e,i){"use strict";const n=i(0);i(23);const o=i(22),s=i(21),r=i(19),a=i(18),l=i(10);function c(t,e){e.frame=t.frame,e.objectModel=t.metadata.objectModel,e.position.copy(t.position),e.rotation.copy(t.rotation),e.fluctuation.set(Math.random()-.5,Math.random()-.5,Math.random()-.5).multiplyScalar(5),e.colorIndex=t.metadata.colorIndex,e.opacity=t.opacity}class h extends l.Composer{patternFeatures(t){const e=super.patternFeatures(t);return t.emission||e.push(l.feature.vanisher(180,60)),e}}class u extends l.Generator{constructor(t){super(),this.baseIndex=t}metadata(t,e){return{objectModel:0==e.generation.length?"meta":t.acceleration&&t.rotation?"missile":t.acceleration?Math.random()<.7?"arrow":"missile":t.rotation?Math.random()<.7?"claw":"missile":Math.random()<.7?"arrow":"missile",colorIndex:this.baseIndex+e.generation.reduce((t,e)=>t+2+e,0)}}}const d=["wisp","crystal"],p={wisp:{bloomRadius:1,particleType:"points",showSurface:!0,showSpace:!1,trailLength:32,trailStep:1,trailAttenuation:.88,trailFluctuation:.96},crystal:{bloomRadius:.2,particleType:"objects",showSurface:!1,showSpace:!0,trailLength:40,trailStep:2,trailAttenuation:.75,trailFluctuation:1}};class f{constructor(t){this.stats=new o,this.stats.showPanel(0),document.body.appendChild(this.stats.dom),this.config=new s.Config,this.satellite=new r.Satellite(t,200),this.view=new a.View(t),this.field=new l.Field,this.root=new l.Particle(this.field,l.feature.none,{objectModel:"meta",colorIndex:0}),this.root.rotation.setToLookAt(new n.Vector3(0,0,0),new n.Vector3(0,0,1),new n.Vector3(0,1,0)),this.initializeConfig()}initializeConfig(){const t=d[Math.floor(Math.random()*d.length)],e=p[t],i=this.config.folder("Renderer"),n=this.config.folder("Viewer"),o=this.config.folder("Simulator"),s=this.config.folder("Core").open(),r=(i.options("antialias","OFF",a.antialiasModes).bind(this.view.renderer,"antialiasMode"),i.toggle("focus",!0).bind(this.view.renderer,"focus"),i.toggle("bloom",!0).bind(this.view.renderer,"bloom"),i.range("bloom strength",.7,[0,3]).step(.1).bind(this.view.renderer,"bloomStrength"),i.range("bloom threshold",.5,[0,1]).step(.1).bind(this.view.renderer,"bloomThreshold"),i.range("bloom radius",e.bloomRadius,[0,1]).step(.1).bind(this.view.renderer,"bloomRadius")),l=n.options("particle type",e.particleType,a.particleTypes).bind(this.view,"particleType"),c=n.range("particle hue",.9,[0,1]).step(.01).bind(this.view,"hue"),h=n.range("particle lightness",.7,[0,1]).step(.01).bind(this.view,"lightness"),u=n.range("trail length",e.trailLength,[1,60]).step(1).bind(this.view,"trailLength"),f=n.range("trail step",e.trailStep,[1,4]).step(1).bind(this.view,"trailStep"),g=n.range("trail opacity",1,[0,1]).step(.01).bind(this.view,"trailOpacity"),m=n.range("trail attenuation",e.trailAttenuation,[0,1]).step(.01).bind(this.view,"trailAttenuation"),y=n.range("trail fluctuation",e.trailFluctuation,[.8,1]).step(.01).bind(this.view,"trailFluctuation"),b=n.toggle("show surface",e.showSurface).bind(this.view.surface,"visible"),w=n.toggle("show space",e.showSpace).bind(this.view.space,"visible");for(const t of[l,c,h,u,f,g,m,y])t.handle(()=>this.view.needsUpdate=!0);const M=s.toggle("pause",!1).bind(this,"isPaused"),v=(s.toggle("show stats",!0).handle(t=>this.stats.dom.style.visibility=t?"visible":"hidden"),s.toggle("camera revolve",!0).bind(this.satellite,"autoRevolve"));window.addEventListener("contextmenu",t=>{M.value=!M.value,v.value=!v.value,t.preventDefault()});o.toggle("emission refresh",!0).bind(this,"emissionRefresh"),o.range("emission strength",400,[10,1e3]).step(1).bind(this,"emissionStrength"),o.range("emission interval",240,[60,600]).step(1).bind(this,"emissionInterval");s.options("preset",t,d).handle(t=>{const e=p[t];r.value=e.bloomRadius,l.value=e.particleType,u.value=e.trailLength,f.value=e.trailStep,m.value=e.trailAttenuation,y.value=e.trailFluctuation,b.value=e.showSurface,w.value=e.showSpace})}update(){this.stats.begin(),this.satellite.update(this.view.camera),this.satellite.isDragging||this.isPaused||(this.root.frame%this.emissionInterval==10&&this.emit(),this.field.update(),this.view.history.putSnapshot(this.field,c),this.view.needsUpdate=!0),this.view.render(),this.stats.end()}emit(){if(!this.currentPattern||this.emissionRefresh){const t=new u(Math.floor(32*Math.random()));this.currentPattern=t.pattern(this.emissionStrength)}(new h).pattern(this.currentPattern)(this.root)}}t.exports=function(){const t=document.getElementById("emitter3d"),e=new f(t);!function t(){e.update(),requestAnimationFrame(t)}()}}]);